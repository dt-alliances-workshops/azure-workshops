{"version":"5","defaultTimeframe":{"from":"now-2h","to":"now","details":{"from":{"type":"expression","normalized":"now-2h","date":"2024-04-14T16:25:54.919Z"},"to":{"type":"expression","normalized":"now","date":"2024-04-14T18:25:54.919Z"}}},"sections":[{"id":"1e842f23-818b-4297-827f-272fe44ce15f","type":"markdown","markdown":"# Welcome to the Dynatrace Workshop! \n## Answers, Analytics, and Automation for Unified Observability and Security\n\n![](https://mkt-cdn.dynatrace.com/assets/Marketing/dynatrace-dash-hero.png)\n\n# Topics\n* Grail - Dynatrace's data lakehouse purpose for observability data. It acts as a single unified storage solution for logs, metrics, traces, events, in full context!\n* Dynatrace Query Language - Unlock answers from the goldmine of observability and security data in Dynatrace!\n* Automation Engine - Proactive prevention, efficient operation, auto-remediation, automated quality checks, and route/report!\n* App Engine - If you can dream it, you can build it!\n\nThis notebook will be your guide today with all of the relevant info you need. We will not cover every lab in the workshop today. After we cover the logs/basics section, we can do a \"chose your own adventure\" based on which data types/features you want to dig into. The workshop is designed to give you the building blocks to understand and use the new platform. You will have access to this demo environment until Aug 25 so you can keep playing around and working on the additional exercises. \n"},{"id":"56af542c-31fd-4088-8e85-994bcec6eb3c","type":"markdown","markdown":"# Log Lab: Answers\n\nThis notebook contains the **answers** to the Log Lab exercises. Use this as a reference after attempting the exercises yourself."},{"id":"d42cc170-d297-4be7-ac53-00c244a9cee0","type":"dql","title":"Answer 1: Basic Log Query","showTitle":true,"state":{"input":{"value":"fetch logs","timeframe":{"from":"now-7d","to":"now","details":{"from":{"type":"expression","normalized":"now-7d","date":"2024-03-31T03:10:40.234Z"},"to":{"type":"expression","normalized":"now","date":"2024-04-07T03:10:40.234Z"}}}},"visualization":"recordView","state":"success","visualizationSettings":{"thresholds":[],"chartSettings":{"gapPolicy":"connect","circleChartSettings":{"groupingThresholdType":"relative","groupingThresholdValue":0,"valueType":"relative"},"categoryOverrides":{}},"singleValue":{"showLabel":true,"label":"","prefixIcon":"","recordField":"timestamp","autoscale":true,"alignment":"center","colorThresholdTarget":"value"},"table":{"rowDensity":"condensed","enableSparklines":false,"hiddenColumns":[],"lineWrapIds":[],"firstVisibleRowIndex":0,"columnWidths":{}},"histogram":{"dataMappings":[]},"honeycomb":{"shape":"square"}}}},{"id":"1f3880c5-1547-4566-a91a-a125f93a48f9","type":"markdown","markdown":"## Let's now query logs for all source but only fetch the first 100 logs and sort them by Timestamp"},{"id":"d6268061-7995-4ae8-920f-af7d2d831d0b","type":"dql","title":"Answer 2: Sort and Limit Results","showTitle":true,"showInput":true,"state":{"input":{"value":"fetch logs\n| sort timestamp desc\n| limit 100","timeframe":{"from":"now-2h","to":"now"}},"state":"success","visualizationSettings":{"singleValue":{"recordField":"timestamp"},"histogram":{"dataMappings":[]},"honeycomb":{"shape":"square"}},"visualization":"table"}},{"id":"434f62c5-1039-4124-9f77-ad418de6969b","type":"markdown","markdown":"### Let's now fetch logs and filter by those that come from Azure services only."},{"id":"427fd3b3-a6a8-4d00-acbc-f9669a8e4d05","type":"dql","title":"Answer 3: Filter Azure Logs","showTitle":true,"state":{"input":{"value":"fetch logs\n| filter cloud.provider == \"azure\"\n| sort timestamp desc","timeframe":{"from":"now-1h","to":"now","details":{"from":{"type":"expression","normalized":"now-1h","date":"2024-03-30T15:15:53.327Z"},"to":{"type":"expression","normalized":"now","date":"2024-03-30T16:15:53.327Z"}}}},"visualization":"table","state":"success","visualizationSettings":{"thresholds":[],"chartSettings":{"gapPolicy":"connect","circleChartSettings":{"groupingThresholdType":"relative","groupingThresholdValue":0,"valueType":"relative"},"categoryOverrides":{},"categoricalBarChartSettings":{}},"singleValue":{"showLabel":true,"label":"","prefixIcon":"","recordField":"timestamp","autoscale":true,"alignment":"center","colorThresholdTarget":"value"},"table":{"rowDensity":"condensed","enableSparklines":false,"hiddenColumns":[],"lineWrapIds":[],"firstVisibleRowIndex":0,"columnWidths":{}},"histogram":{"dataMappings":[]},"honeycomb":{"shape":"square"}}}},{"id":"6bc9297c-bfb4-4118-b88b-5887665150f8","type":"markdown","markdown":"### Let's now add upon the previous query and only fetch logs for specific Azure resource type"},{"id":"41711030-f98e-4c4b-8a16-c27967ce7009","type":"dql","title":"Answer 4: Filter by Resource Type","showTitle":true,"state":{"input":{"value":"fetch logs\n| filter cloud.provider == \"azure\"\n| filter azure.resource.type == \"MICROSOFT.NETWORK/NETWORKSECURITYGROUPS\"\n| sort timestamp desc","timeframe":{"from":"now-24h","to":"now","details":{"from":{"type":"expression","normalized":"now-24h","date":"2024-04-07T14:44:39.365Z"},"to":{"type":"expression","normalized":"now","date":"2024-04-08T14:44:39.365Z"}}}},"visualization":"table","state":"success","visualizationSettings":{"thresholds":[],"chartSettings":{"gapPolicy":"connect","circleChartSettings":{"groupingThresholdType":"relative","groupingThresholdValue":0,"valueType":"relative"},"categoryOverrides":{},"categoricalBarChartSettings":{}},"singleValue":{"showLabel":true,"label":"","prefixIcon":"","recordField":"timestamp","autoscale":true,"alignment":"center","colorThresholdTarget":"value"},"table":{"rowDensity":"condensed","enableSparklines":false,"hiddenColumns":[],"lineWrapIds":[],"firstVisibleRowIndex":0,"columnWidths":{}},"histogram":{"dataMappings":[]},"honeycomb":{"shape":"square"}}}},{"id":"9db308c2-5494-494b-b416-1ca3007a8c73","type":"markdown","markdown":"### Now we are fetching logs for all Azure resource types and summarizing the count."},{"id":"c654880c-d203-461b-808a-d40532732230","type":"dql","title":"Answer 5: Summarize Log Counts","showTitle":true,"state":{"input":{"value":"fetch logs\n| filter cloud.provider == \"azure\"\n| summarize count(), by:{azure.resource.type}\n| sort `count()`, direction:\"descending\"","timeframe":{"from":"now-1h","to":"now","details":{"from":{"type":"expression","normalized":"now-1h","date":"2024-03-29T18:50:01.008Z"},"to":{"type":"expression","normalized":"now","date":"2024-03-29T19:50:01.008Z"}}}},"visualization":"table","state":"success","visualizationSettings":{"thresholds":[],"chartSettings":{"gapPolicy":"connect","circleChartSettings":{"groupingThresholdType":"relative","groupingThresholdValue":0,"valueType":"relative"},"categoryOverrides":{},"categoricalBarChartSettings":{"categoryAxis":"azure.resource.type","categoryAxisLabel":"azure.resource.type","valueAxis":"count()","valueAxisLabel":"count()"}},"singleValue":{"showLabel":true,"label":"","prefixIcon":"","recordField":"status","autoscale":true,"alignment":"center","colorThresholdTarget":"value"},"table":{"rowDensity":"condensed","enableSparklines":false,"hiddenColumns":[],"lineWrapIds":[],"firstVisibleRowIndex":0,"columnWidths":{}},"histogram":{"dataMappings":[{"valueAxis":"count()","rangeAxis":""}]},"honeycomb":{"shape":"square"}}}},{"id":"e52bb103-fba1-49b7-b07e-72a03897544b","type":"dql","title":"Answer 6: Multi-Field Grouping","showTitle":true,"state":{"input":{"value":"fetch logs\n| filter cloud.provider == \"azure\"\n| summarize count(), by:{loglevel,azure.resource.type}\n","timeframe":{"from":"now-7d","to":"now","details":{"from":{"type":"expression","normalized":"now-7d","date":"2024-03-31T03:10:40.234Z"},"to":{"type":"expression","normalized":"now","date":"2024-04-07T03:10:40.234Z"}}}},"visualization":"table","state":"success","visualizationSettings":{"thresholds":[],"chartSettings":{"gapPolicy":"connect","circleChartSettings":{"groupingThresholdType":"relative","groupingThresholdValue":0,"valueType":"relative"},"categoryOverrides":{},"categoricalBarChartSettings":{"categoryAxis":"loglevel","valueAxis":"count()","categoryAxisLabel":"loglevel","valueAxisLabel":"count()"}},"singleValue":{"showLabel":true,"label":"","prefixIcon":"","autoscale":true,"alignment":"center","colorThresholdTarget":"value","recordField":"azure.resource.type"},"table":{"rowDensity":"condensed","enableSparklines":false,"hiddenColumns":[],"lineWrapIds":[],"firstVisibleRowIndex":0,"columnWidths":{}},"histogram":{"dataMappings":[{"valueAxis":"count()","rangeAxis":""}]},"honeycomb":{"shape":"square"}}}},{"id":"ef41adde-854b-4e5c-bcd4-13ead7494044","type":"markdown","markdown":"# Advanced Logs Query\n"},{"id":"02b818ea-fcd6-4bc6-ae5d-feb89ab72b94","type":"markdown","markdown":"## Now using the second application called Hipstershop that we deployed onto the AKS cluster, we'll query the logs for them. "},{"id":"c52075b6-d231-4be6-972d-674ddfe75209","type":"dql","title":"Log Lab: Filtering on cart service container (don't filter on things that change like pod name)","showTitle":false,"state":{"input":{"value":"fetch logs\n| filter matchesPhrase (k8s.deployment.name,\"cartservice\")\n| filter matchesPhrase(content, \"AddItemAsync\")","timeframe":{"from":"now-2h","to":"now","details":{"from":{"type":"expression","normalized":"now-2h","date":"2024-04-14T16:25:15.391Z"},"to":{"type":"expression","normalized":"now","date":"2024-04-14T18:25:15.391Z"}}}},"state":"success","visualizationSettings":{"thresholds":[],"chartSettings":{"gapPolicy":"connect","circleChartSettings":{"groupingThresholdType":"relative","groupingThresholdValue":0,"valueType":"relative"},"categoryOverrides":{}},"singleValue":{"showLabel":true,"label":"","prefixIcon":"","autoscale":true,"alignment":"center","colorThresholdTarget":"value","recordField":"timestamp"},"table":{"rowDensity":"condensed","enableSparklines":false,"hiddenColumns":[],"lineWrapIds":[],"firstVisibleRowIndex":0,"columnWidths":{}},"histogram":{"dataMappings":[]},"honeycomb":{"shape":"square"}},"visualization":"table"}},{"id":"b0c7e75e-3e27-4f2c-9c46-7fe06976b37f","type":"markdown","markdown":"### What If I need to extract user, product and quantity, but we didn't set up parsing/processing rules before the logs were ingested. \n### No worries! DQL to the rescue!"},{"id":"36f31918-d18d-4f19-aa42-389b8268f8bb","type":"dql","showTitle":false,"state":{"input":{"value":"Fetch logs\n|filter contains(content, \"AddItemAsync\")\n|parse content, \"LD 'userId='LD:userId', productId='LD:ProductId', quantity='INT:ProductQuantity\"\n|fields ProductId, ProductQuantity, userId","timeframe":{"from":"now-2h","to":"now","details":{"from":{"type":"expression","normalized":"now-2h","date":"2024-04-14T16:25:44.672Z"},"to":{"type":"expression","normalized":"now","date":"2024-04-14T18:25:44.672Z"}}}},"visualization":"table","state":"success","visualizationSettings":{"thresholds":[],"chartSettings":{"gapPolicy":"connect","circleChartSettings":{"groupingThresholdType":"relative","groupingThresholdValue":0,"valueType":"relative"},"categoryOverrides":{},"categoricalBarChartSettings":{"categoryAxis":"ProductId","categoryAxisLabel":"ProductId","valueAxis":"ProductQuantity","valueAxisLabel":"ProductQuantity"}},"singleValue":{"showLabel":true,"label":"","prefixIcon":"","autoscale":true,"alignment":"center","colorThresholdTarget":"value","recordField":"ProductId"},"table":{"rowDensity":"condensed","enableSparklines":false,"hiddenColumns":[],"lineWrapIds":[],"firstVisibleRowIndex":0,"columnWidths":{}},"histogram":{"dataMappings":[{"valueAxis":"ProductQuantity","rangeAxis":""}]},"honeycomb":{"shape":"square"}}}},{"id":"32050ba4-7326-4fda-8a03-8007b67d651b","type":"markdown","markdown":"### Now that we have all of that data extracted, let's analyze the purchases"},{"id":"53ed048a-aa4f-44df-b3e1-dc2ca37dc6db","type":"dql","title":"Total Purchases - Last 24 hours","showTitle":false,"state":{"input":{"value":"Fetch logs, from: now() -24h\n|filter contains(content, \"AddItemAsync\")\n|parse content, \"LD 'userId='LD:userId', productId='LD:ProductId', quantity='INT:ProductQuantity\"\n|fields ProductId, ProductQuantity, userId\n|summarize sum(ProductQuantity), Alias:Quantity, by:{ProductId}","timeframe":{"from":"now-2h","to":"now","details":{"from":{"type":"expression","normalized":"now-2h","date":"2024-04-14T16:25:54.919Z"},"to":{"type":"expression","normalized":"now","date":"2024-04-14T18:25:54.919Z"}}}},"state":"success","visualizationSettings":{"thresholds":[],"chartSettings":{"gapPolicy":"connect","circleChartSettings":{"groupingThresholdType":"relative","groupingThresholdValue":0,"valueType":"relative"},"categoryOverrides":{},"categoricalBarChartSettings":{"categoryAxis":"ProductId","categoryAxisLabel":"ProductId","valueAxis":"Quantity","valueAxisLabel":"Quantity"}},"singleValue":{"showLabel":true,"label":"","prefixIcon":"","autoscale":true,"alignment":"center","colorThresholdTarget":"value","recordField":"Quantity"},"table":{"rowDensity":"condensed","enableSparklines":false,"hiddenColumns":[],"lineWrapIds":[],"firstVisibleRowIndex":0,"columnWidths":{}},"histogram":{"dataMappings":[{"valueAxis":"Quantity","rangeAxis":""}]},"honeycomb":{"shape":"square"}},"visualization":"singleValue"}},{"id":"c117610a-4bab-4de0-98c1-c1af29c3d5c4","type":"dql","showTitle":false,"title":"Purchases by Product Type - Last 24 Hours","state":{"input":{"value":"Fetch logs, from: now() -24h\n|filter contains(content, \"AddItemAsync\")\n|parse content, \"LD 'userId='LD:userId', productId='LD:ProductId', quantity='INT:ProductQuantity\"\n|fields ProductId, ProductQuantity, userId\n|summarize sum(ProductQuantity), Alias:Quantity, by:{ProductId}","timeframe":{"from":"now-24h","to":"now","details":{"from":{"type":"expression","normalized":"now-24h","date":"2024-04-07T14:43:50.207Z"},"to":{"type":"expression","normalized":"now","date":"2024-04-08T14:43:50.207Z"}}}},"state":"success","visualizationSettings":{"chartSettings":{"categoricalBarChartSettings":{"categoryAxis":"ProductId","categoryAxisLabel":"ProductId","valueAxis":"Quantity","valueAxisLabel":"Quantity"}},"singleValue":{"recordField":"ProductId"},"histogram":{"dataMappings":[{"valueAxis":"Quantity","rangeAxis":""}]},"honeycomb":{"shape":"square"}},"visualization":"table"}},{"id":"83a0ab40-74c9-4d75-ab3e-2a14858c8644","type":"markdown","markdown":"## You can quick convert the table view above to a chart above.  Here are some steps\n- Click on notebook section and click on Options.  \n![](https://github.com/dt-alliances-workshops/learn-site-content/blob/grail-azure/workshop-markdown/azure-grail-lab4/img/workbook-options.png?raw=true)\n- On the right hand side you will see several visualization options.  Select the pie chart\n![](https://github.com/dt-alliances-workshops/learn-site-content/blob/grail-azure/workshop-markdown/azure-grail-lab4/img/workbook-visualizations.png?raw=true)\n"}]}